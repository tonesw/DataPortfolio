/* Stored Procedure to update or replace previous author values if the Author's ID already
	exists in the Author Table within the FACT schema, or add these values as an entity if
	the author ID value does not exist in the Author table */
CREATE OR ALTER PROCEDURE FACT.spUpsertAuthor @MYAUID INT, @MYFNAME VARCHAR(10), @MYLNAME VARCHAR(20),@MYYEAR INT AS 
DECLARE
	@AUTHOREXISTS INT;
	BEGIN TRANSACTION MYTRANSACTION
BEGIN

	IF @MYAUID IN (SELECT AU_ID FROM FACT.AUTHOR WHERE AU_ID = @MYAUID)
		BEGIN
		--AUTHOR DOES EXIST
			SET @AUTHOREXISTS = 1;
			PRINT CONCAT('You are replacing values: ',AU_ID,AU_FNAME,AU_LNAME,AU_BIRTHYEAR)
			UPDATE FACT.AUTHOR
			SET AU_FNAME = @MYFNAME,
				AU_LNAME = @MYLNAME,
				AU_BIRTHYEAR = @MYYEAR
			WHERE AU_ID = @MYAUID
		END;
	ELSE
		BEGIN
		--AUTHOR DOES NOT EXIST
			SET @AUTHOREXISTS = 0;
			INSERT INTO FACT.AUTHOR(AU_ID,AU_FNAME,AU_LNAME,AU_BIRTHYEAR)
			VALUES (@MYAUID,@MYFNAME,@MYLNAME,@MYYEAR)
		END;
END;
EXEC spUpsertAuthor 185,Benson,Reeves,1990;

ROLLBACK TRANSACTION MYTRANSACTION
